@inject NavigationManager Navigation

<div class="card shadow-sm mb-3 h-100 contract-hover position-relative"
     style="border-radius: 14px; overflow: hidden;"
     @onclick="@(() => Navigation.NavigateTo($"/contract/{Id}"))">

    <!-- Three-dots menu -->
    <button class="btn btn-sm btn-light position-absolute top-0 end-0 m-2 p-1"
            @onclick:stopPropagation="true"
            @onclick="OpenDelete">
        <i class="bi bi-three-dots-vertical" style="color:black"></i>
    </button>

    <!-- Pin button -->
    <button type="button"
            class="pin-btn @(IsPinned ? "pinned" : null)"
            aria-pressed="@(IsPinned ? "true" : "false")"
            title="@(IsPinned ? "Unpin" : "Pin")"
            @onclick:stopPropagation="true"
            @onclick="OnTogglePin">
        <i class="bi @(IsPinned ? "bi-pin-angle-fill" : "bi-pin-angle")"></i>
    </button>

    <!-- Visibility tag -->
    <div class="position-absolute top-0 start-0 m-2">
        <span class="visibility-badge @(IsPublic ? "public" : "private")">
            <i class="bi @(IsPublic ? "bi-globe-americas" : "bi-lock-fill") me-1"></i>
            @(IsPublic ? "Public" : "Private")
        </span>
    </div>

    <div class="card-body d-flex flex-column mt-4">
        <h5 class="card-title fw-semibold contract-title text-truncate">@FileName</h5>
        <p class="text-muted mb-1">Uploaded by <strong>@UploadedBy</strong></p>
        <small class="text-muted">Uploaded: @UploadDate.ToShortDateString()</small>
    </div>
</div>

@code {
    [Parameter] public int Id { get; set; }
    [Parameter] public string FileName { get; set; } = default!;
    [Parameter] public int UserId { get; set; }
    [Parameter] public string? UploadedBy { get; set; }
    [Parameter] public DateTime UploadDate { get; set; }
    [Parameter] public EventCallback<int> OnDelete { get; set; }
    [Parameter] public bool IsPublic { get; set; }
    [Parameter] public bool IsPinned { get; set; }
    [Parameter] public EventCallback OnTogglePin { get; set; }

    private async Task OpenDelete()
    {
        if (OnDelete.HasDelegate)
            await OnDelete.InvokeAsync(Id);
    }
}
